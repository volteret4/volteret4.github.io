<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Last.fm Stats - December 2012</title>
    <link rel="icon" type="image/png" href="images/music.png">
    <!-- Umami Analytics -->
    <script defer src="https://cloud.umami.is/script.js" data-website-id="5d84fd6c-0760-4a0c-a2d0-ffabb82179f5"></script>

    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #1e1e2e;
            color: #cdd6f4;
            padding: 20px;
            line-height: 1.6;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: #181825;
            border-radius: 16px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.3);
            overflow: hidden;
        }

        header {
            background: #1e1e2e;
            padding: 20px 30px;
            border-bottom: 2px solid #cba6f7;
            display: flex;
            justify-content: space-between;
            align-items: center;
            min-height: 80px;
        }

        .header-content {
            display: flex;
            flex-direction: column;
            align-items: center;
            flex-grow: 1;
        }

        h1 {
            font-size: 1.8em;
            color: #cba6f7;
            margin: 0;
            text-align: center;
        }

        .nav-buttons {
            display: flex;
            gap: 15px;
            margin-top: 10px;
        }

        .nav-button {
            padding: 8px 16px;
            background: #313244;
            color: #cdd6f4;
            border: 2px solid #45475a;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 0.9em;
            font-weight: 600;
            text-decoration: none;
            display: inline-block;
        }

        .nav-button:hover {
            border-color: #cba6f7;
            background: #45475a;
            color: #cdd6f4;
        }

        .nav-button.current {
            background: #cba6f7;
            color: #1e1e2e;
            border-color: #cba6f7;
        }

        .user-button {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: #181825;
            color: #1e1e2e;
            border: none;
            cursor: pointer;
            font-size: 1.2em;
            font-weight: bold;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s;
            flex-shrink: 0;
        }

        .user-button:hover {
            background: #b4a3e8;
            transform: scale(1.1);
        }

        .user-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.8);
            z-index: 1000;
            backdrop-filter: blur(5px);
        }

        .user-modal-content {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: #1e1e2e;
            border-radius: 12px;
            padding: 30px;
            width: 90%;
            max-width: 400px;
            border: 2px solid #cba6f7;
        }

        .user-modal-header {
            color: #cba6f7;
            font-size: 1.3em;
            font-weight: 600;
            margin-bottom: 20px;
            text-align: center;
        }

        .user-modal-close {
            position: absolute;
            top: 15px;
            right: 20px;
            background: none;
            border: none;
            color: #cdd6f4;
            font-size: 1.5em;
            cursor: pointer;
            padding: 0;
        }

        .user-modal-close:hover {
            color: #cba6f7;
        }

        .user-options {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .user-option {
            padding: 12px 20px;
            background: #313244;
            border: 2px solid #45475a;
            border-radius: 8px;
            color: #cdd6f4;
            cursor: pointer;
            transition: all 0.3s;
            text-align: center;
        }

        .user-option:hover {
            border-color: #cba6f7;
            background: #45475a;
        }

        .user-option.selected {
            background: #cba6f7;
            color: #1e1e2e;
            border-color: #cba6f7;
        }

        .controls {
            padding: 20px 30px;
            background: #1e1e2e;
            border-bottom: 1px solid #313244;
            display: flex;
            gap: 20px;
            flex-wrap: wrap;
            align-items: center;
            justify-content: center;
        }

        .control-group {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 10px;
        }

        .control-group label {
            color: #cba6f7;
            font-weight: 600;
        }

        .category-filters {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .category-filter {
            padding: 8px 16px;
            background: #313244;
            color: #cdd6f4;
            border: 2px solid #45475a;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 0.9em;
            font-weight: 600;
        }

        .category-filter:hover {
            border-color: #cba6f7;
            background: #45475a;
        }

        .category-filter.active {
            background: #cba6f7;
            color: #1e1e2e;
            border-color: #cba6f7;
        }

        .period-header {
            background: #1e1e2e;
            padding: 25px 30px;
            border-bottom: 2px solid #cba6f7;
        }

        .period-header h2 {
            color: #cba6f7;
            font-size: 1.5em;
            margin-bottom: 8px;
        }

        .period-info {
            color: #a6adc8;
            font-size: 0.9em;
        }

        .stats-container {
            padding: 30px;
        }

        .categories {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(450px, 1fr));
            gap: 25px;
        }

        .category {
            background: #1e1e2e;
            border-radius: 12px;
            padding: 20px;
            border: 1px solid #313244;
            display: none;
        }

        .category.visible {
            display: block;
        }

        .category h3 {
            color: #cba6f7;
            font-size: 1.2em;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 2px solid #cba6f7;
        }

        .item {
            padding: 12px;
            margin-bottom: 10px;
            background: #181825;
            border-radius: 8px;
            border-left: 3px solid #45475a;
            transition: all 0.3s;
            cursor: pointer;
        }

        .item:hover {
            transform: translateX(5px);
            border-left-color: #cba6f7;
        }

        .item.highlighted {
            border-left-color: #cba6f7;
            background: #1a1826;
        }

        .item-name {
            font-weight: 600;
            color: #cdd6f4;
            font-size: 1em;
        }

        .item-meta {
            margin-top: 8px;
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
            align-items: center;
        }

        .badge {
            background: #45475a;
            color: #cdd6f4;
            padding: 4px 10px;
            border-radius: 20px;
            font-size: 0.8em;
            font-weight: 600;
        }

        .user-badge {
            background: #313244;
            color: #a6adc8;
            padding: 4px 10px;
            border-radius: 20px;
            font-size: 0.75em;
            border: 1px solid #45475a;
        }

        .user-badge.highlighted-user {
            background: #cba6f7;
            color: #1e1e2e;
            border-color: #cba6f7;
        }

        .expandable {
            position: relative;
        }

        .expandable::after {
            content: '‚ñº';
            position: absolute;
            right: 12px;
            top: 12px;
            color: #6c7086;
            font-size: 0.8em;
        }

        .expandable.expanded::after {
            content: '‚ñ≤';
        }

        .details {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease;
            padding: 0 15px;
            margin-top: 10px;
        }

        .details.expanded {
            max-height: 400px;
            overflow-y: auto;
            border-top: 1px solid #313244;
            padding-top: 15px;
        }

        .detail-section {
            margin-bottom: 15px;
        }

        .detail-title {
            color: #f9e2af;
            font-size: 0.9em;
            font-weight: 600;
            margin-bottom: 8px;
        }

        .detail-list {
            display: flex;
            flex-wrap: wrap;
            gap: 5px;
        }

        .detail-item {
            background: #181825;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 0.8em;
            color: #a6adc8;
        }

        .novelty-section {
            margin-bottom: 25px;
        }

        .novelty-section h4 {
            color: #a6e3a1;
            font-size: 1.05em;
            margin-bottom: 15px;
            padding-bottom: 8px;
            border-bottom: 1px solid #45475a;
        }

        .novelty-subsection {
            margin-bottom: 20px;
        }

        .novelty-subsection h5 {
            color: #f9e2af;
            font-size: 0.95em;
            margin-bottom: 10px;
        }

        .novelty-empty {
            color: #6c7086;
            font-style: italic;
            text-align: center;
            padding: 20px;
        }

        .artists-popup {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: #1e1e2e;
            border: 2px solid #cba6f7;
            border-radius: 12px;
            padding: 20px;
            max-width: 500px;
            max-height: 400px;
            overflow-y: auto;
            z-index: 1000;
            box-shadow: 0 8px 32px rgba(0,0,0,0.5);
        }

        .popup-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.8);
            z-index: 999;
        }

        .popup-header {
            color: #cba6f7;
            font-size: 1.1em;
            font-weight: 600;
            margin-bottom: 15px;
            border-bottom: 1px solid #313244;
            padding-bottom: 10px;
        }

        .popup-close {
            float: right;
            background: none;
            border: none;
            color: #cdd6f4;
            font-size: 1.2em;
            cursor: pointer;
            padding: 0;
            margin-top: -5px;
        }

        .popup-close:hover {
            color: #cba6f7;
        }

        .artist-list {
            list-style: none;
            padding: 0;
        }

        .artist-list li {
            padding: 8px 12px;
            background: #181825;
            margin-bottom: 5px;
            border-radius: 6px;
            border-left: 3px solid #45475a;
        }

        .no-data {
            text-align: center;
            padding: 40px;
            color: #6c7086;
            font-style: italic;
        }

        .last-update {
            text-align: center;
            padding: 20px;
            color: #6c7086;
            font-size: 0.85em;
            border-top: 1px solid #313244;
        }

        @media (max-width: 768px) {
            .categories {
                grid-template-columns: 1fr;
            }

            .controls {
                flex-direction: column;
                align-items: stretch;
            }

            .category-filters {
                justify-content: center;
            }

            .artists-popup {
                max-width: 90%;
                max-height: 80%;
            }

            header {
                flex-direction: column;
                gap: 15px;
            }

            .nav-buttons {
                order: -1;
            }

            .user-button {
                order: 1;
                align-self: flex-end;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <div class="header-content">
                <h1>üìä RYM Hispano Estad√≠sticas</h1>
                <div class="nav-buttons">
                    <a href="esta-semana.html" class="nav-button">TEMPORALES</a>
                    <a href="index.html#grupo" class="nav-button">GRUPO</a>
                    <a href="index.html#about" class="nav-button">ACERCA DE</a>
                </div>
            </div>
            <button class="user-button" id="userButton">üë§</button>
        </header>

        <!-- Modal de selecci√≥n de usuario -->
        <div class="user-modal" id="userModal">
            <div class="user-modal-content">
                <button class="user-modal-close" id="userModalClose">√ó</button>
                <div class="user-modal-header">Seleccionar Usuario</div>
                <div class="user-options" id="userOptions">
                    <!-- Se llenar√°n din√°micamente -->
                </div>
            </div>
        </div>

        <div class="controls">
            <div class="control-group">

                <div class="category-filters">
                    <button class="category-filter active" data-category="artists">Artistas</button><button class="category-filter " data-category="tracks">Canciones</button><button class="category-filter " data-category="albums">√Ålbumes</button><button class="category-filter " data-category="genres">G√©neros</button><button class="category-filter " data-category="labels">Sellos</button><button class="category-filter " data-category="years">A√±os</button><button class="category-filter " data-category="novelties">Novedades</button>
                </div>
            </div>
        </div>

        <div class="period-header">
            <h2>December 2012</h2>
            <p class="period-info">
                <span id="dateRange"></span> |
                <span id="totalScrobbles"></span> scrobbles totales
            </p>
        </div>

        <div class="stats-container">
            <div class="categories" id="categoriesContainer">
                <!-- Se llenar√° din√°micamente -->
            </div>
        </div>

        <div class="last-update">
            Generado: <span id="generatedAt"></span>
        </div>
    </div>

    <script>
        // Usuarios reales del entorno LASTFM_USERS
        const availableUsers = ["alberto_gu", "EliasJ72", "Frikomid", "GabredMared", "Lonsonxd", "Nubis84", "paqueradejere", "Rocky_stereo", "sdecandelario"];
        const stats = {
  "total_scrobbles": 2311,
  "artists": [],
  "tracks": [],
  "albums": [],
  "genres": [
    {
      "name": "rock",
      "count": 709,
      "users": [
        "sdecandelario",
        "paqueradejere"
      ],
      "user_counts": {
        "paqueradejere": 14,
        "sdecandelario": 695
      },
      "user_artists": {
        "paqueradejere": [
          "PJ Harvey"
        ],
        "sdecandelario": [
          "Supergrass",
          "Ted Nugent",
          "Skunk Anansie",
          "Joe Walsh",
          "Modest Mouse",
          "Pappo's Blues",
          "White Rabbits",
          "Them Crooked Vultures",
          "L7",
          "Tiger Army",
          "Leonard Cohen",
          "No Doubt",
          "Jay Malinowski",
          "The Black Keys",
          "The Rolling Stones",
          "The Subways",
          "Interpol",
          "Muse",
          "The Sonics",
          "Love",
          "T. Rex",
          "Neil Young",
          "The Kicks",
          "The Offspring",
          "Kings of Leon",
          "Ozzy Osbourne",
          "Sweet",
          "Porcupine Tree",
          "Jimi Hendrix",
          "Rosendo",
          "Obits",
          "Nine Inch Nails",
          "H√©roes del Silencio",
          "Janis Joplin",
          "Kaiser Chiefs",
          "The Jimi Hendrix Experience",
          "The Bouncing Souls",
          "Scorpions",
          "Roxy Music",
          "Pixies",
          "Killing Joke",
          "Iron Maiden",
          "The Allman Brothers Band",
          "Rush",
          "R.E.M.",
          "Queens of the Stone Age",
          "The Weakerthans",
          "Pennywise",
          "The Evens",
          "The Hives",
          "NOFX",
          "This Is Me Smiling",
          "The Bravery",
          "Spector",
          "Soundgarden",
          "Nirvana",
          "Nazareth",
          "Linkin Park",
          "The Joy Formidable",
          "Youth Group",
          "Hot Water Music",
          "Soda Stereo",
          "Nada Surf",
          "Mot√∂rhead",
          "The Cult",
          "Matchbook Romance",
          "Halestorm",
          "The Special Goodness",
          "The Gaslight Anthem",
          "Iggy Pop",
          "The Cure",
          "Sparklehorse",
          "The Killers",
          "Tame Impala",
          "The Soft Pack",
          "Simon & Garfunkel",
          "Platero y t√∫",
          "The Dream Syndicate",
          "Social Distortion",
          "M√∂tley Cr√ºe",
          "Rod Stewart",
          "Millencolin",
          "Kyuss",
          "Rival Sons",
          "Pavement",
          "The Clash",
          "Rise Against",
          "The 69 Eyes",
          "Motion City Soundtrack",
          "Pearl Jam",
          "Metallica",
          "Straylight Run",
          "The Smashing Pumpkins",
          "The Matches",
          "The Strokes",
          "The Temper Trap",
          "Rancid"
        ]
      },
      "top_artists": [
        "Rosendo",
        "The Strokes",
        "Nine Inch Nails",
        "The Hives",
        "Queens of the Stone Age",
        "Spector",
        "Pennywise",
        "Metallica",
        "The Cure",
        "Muse"
      ],
      "top_albums": [
        "Nine Inch Nails - Ghosts I-IV",
        "Spector - Enjoy It While It Lasts",
        "R.E.M. - And I Feel Fine.....The Best Of The IRS Years 82-87",
        "The Strokes - Angles",
        "Queens of the Stone Age - Lullabies to Paralyze",
        "NOFX - Punk in Drublic",
        "Metallica - Death Magnetic",
        "The Cure - 4:13 Dream",
        "Queens of the Stone Age - Songs for the Deaf",
        "PJ Harvey - Rid of Me"
      ]
    },
    {
      "name": "indie",
      "count": 391,
      "users": [
        "sdecandelario",
        "paqueradejere"
      ],
      "user_counts": {
        "paqueradejere": 14,
        "sdecandelario": 377
      },
      "user_artists": {
        "paqueradejere": [
          "PJ Harvey"
        ],
        "sdecandelario": [
          "The Killers",
          "This Is Me Smiling",
          "Pomegranates",
          "Schwarz",
          "The Babies",
          "The Bravery",
          "Obits",
          "Manel",
          "Spector",
          "The Soft Pack",
          "Modest Mouse",
          "White Rabbits",
          "Tri√°ngulo de Amor Bizarro",
          "Junius",
          "The Limi√±anas",
          "Tiger Lou",
          "Teen Daze",
          "Kaiser Chiefs",
          "alt-J",
          "The Tamborines",
          "Sonic Youth",
          "Real Estate",
          "The Drums",
          "Pixies",
          "Mikal Cronin",
          "Helvetia",
          "MGMT",
          "The Naked and Famous",
          "The Black Keys",
          "The Joy Formidable",
          "Klaxons",
          "Museum",
          "Pavement",
          "Mumford & Sons",
          "R.E.M.",
          "The Feelies",
          "The Rapture",
          "Youth Group",
          "White Lies",
          "Simian",
          "The Subways",
          "Nada Surf",
          "Interpol",
          "Muse",
          "The Weakerthans",
          "Motion City Soundtrack",
          "Ratatat",
          "The Smiths",
          "The Ting Tings",
          "The Kicks",
          "The Special Goodness",
          "The Evens",
          "The Gaslight Anthem",
          "Kings of Leon",
          "Straylight Run",
          "Sparklehorse",
          "Joy Division",
          "Thieving Irons",
          "The Hives",
          "The Strokes",
          "The Temper Trap",
          "Supergrass",
          "my bloody valentine"
        ]
      },
      "top_artists": [
        "The Strokes",
        "The Hives",
        "Spector",
        "Muse",
        "Interpol",
        "R.E.M.",
        "The Drums",
        "PJ Harvey",
        "The Soft Pack",
        "Mumford & Sons"
      ],
      "top_albums": [
        "Spector - Enjoy It While It Lasts",
        "R.E.M. - And I Feel Fine.....The Best Of The IRS Years 82-87",
        "The Strokes - Angles",
        "PJ Harvey - Rid of Me",
        "Interpol - Antics",
        "The Drums - The Drums",
        "The Soft Pack - Strapped",
        "The Strokes - First Impressions of Earth",
        "Mumford & Sons - Babel",
        "The Hives - The Black and White Album"
      ]
    },
    {
      "name": "alternative",
      "count": 386,
      "users": [
        "sdecandelario",
        "paqueradejere"
      ],
      "user_counts": {
        "paqueradejere": 24,
        "sdecandelario": 362
      },
      "user_artists": {
        "paqueradejere": [
          "PJ Harvey",
          "UNKLE"
        ],
        "sdecandelario": [
          "The Killers",
          "Skunk Anansie",
          "Putilatex",
          "The Bravery",
          "Nine Inch Nails",
          "Modest Mouse",
          "White Rabbits",
          "Social Distortion",
          "Soundgarden",
          "Kaiser Chiefs",
          "alt-J",
          "Nirvana",
          "Sonic Youth",
          "No Doubt",
          "Pixies",
          "Helvetia",
          "Linkin Park",
          "MGMT",
          "The Chameleons",
          "Museum",
          "Pavement",
          "The Feelies",
          "R.E.M.",
          "Youth Group",
          "Queens of the Stone Age",
          "White Lies",
          "The Subways",
          "Nada Surf",
          "Interpol",
          "Muse",
          "The Weakerthans",
          "Motion City Soundtrack",
          "Ratatat",
          "The Smiths",
          "The Kicks",
          "The Offspring",
          "Pearl Jam",
          "Matchbook Romance",
          "Kings of Leon",
          "Straylight Run",
          "The Smashing Pumpkins",
          "Sparklehorse",
          "Joy Division",
          "The Matches",
          "Thieving Irons",
          "The Cure",
          "The Strokes",
          "The Temper Trap",
          "Supergrass",
          "my bloody valentine"
        ]
      },
      "top_artists": [
        "The Strokes",
        "Nine Inch Nails",
        "Queens of the Stone Age",
        "The Cure",
        "Muse",
        "Interpol",
        "R.E.M.",
        "PJ Harvey",
        "Linkin Park",
        "The Kicks"
      ],
      "top_albums": [
        "Nine Inch Nails - Ghosts I-IV",
        "R.E.M. - And I Feel Fine.....The Best Of The IRS Years 82-87",
        "The Strokes - Angles",
        "Queens of the Stone Age - Lullabies to Paralyze",
        "The Cure - 4:13 Dream",
        "Queens of the Stone Age - Songs for the Deaf",
        "PJ Harvey - Rid of Me",
        "Interpol - Antics",
        "The Strokes - First Impressions of Earth",
        "Muse - Showbiz"
      ]
    },
    {
      "name": "electronic",
      "count": 235,
      "users": [
        "sdecandelario",
        "paqueradejere"
      ],
      "user_counts": {
        "paqueradejere": 63,
        "sdecandelario": 172
      },
      "user_artists": {
        "paqueradejere": [
          "The Black Dog",
          "The Avalanches",
          "UNKLE",
          "Leo Anibaldi",
          "Loess"
        ],
        "sdecandelario": [
          "Massive Attack",
          "The Japanese Popstars",
          "Putilatex",
          "Spector",
          "Nine Inch Nails",
          "Umberto",
          "Lust for Youth",
          "Touch and Go",
          "Prodigy",
          "Pendulum",
          "Teen Daze",
          "Holy Ghost!",
          "alt-J",
          "Miike Snow",
          "Tickles",
          "Marco Dos Santos",
          "The Naked and Famous",
          "MGMT",
          "Jamiroquai",
          "Junior Senior",
          "VNV Nation",
          "The Knife",
          "Klaxons",
          "Toy",
          "The Rapture",
          "Michna",
          "Simian",
          "The Prodigy",
          "Nitzer Ebb",
          "Ratatat",
          "The Ting Tings",
          "The Chemical Brothers",
          "Rrose",
          "Ladytron",
          "R√∂yksopp",
          "Justice"
        ]
      },
      "top_artists": [
        "Nine Inch Nails",
        "Spector",
        "The Avalanches",
        "The Black Dog",
        "Michna",
        "Holy Ghost!",
        "The Chemical Brothers",
        "Miike Snow",
        "UNKLE",
        "The Ting Tings"
      ],
      "top_albums": [
        "Nine Inch Nails - Ghosts I-IV",
        "Spector - Enjoy It While It Lasts",
        "The Avalanches - Since I Left You",
        "The Black Dog - Ov Mind, Ov Magick",
        "Michna - Magic Monday",
        "Miike Snow - Miike Snow",
        "Holy Ghost! - Holy Ghost!",
        "Nine Inch Nails - The Slip",
        "The Black Dog - Music for Real Airports",
        "UNKLE - Never, Never, Land [Japan Bonus Track]"
      ]
    },
    {
      "name": "electronica",
      "count": 93,
      "users": [
        "sdecandelario",
        "paqueradejere"
      ],
      "user_counts": {
        "paqueradejere": 62,
        "sdecandelario": 31
      },
      "user_artists": {
        "paqueradejere": [
          "The Black Dog",
          "Loess",
          "The Avalanches",
          "UNKLE"
        ],
        "sdecandelario": [
          "Junior Senior",
          "Pendulum",
          "Ratatat",
          "Massive Attack",
          "The Knife",
          "The Chemical Brothers",
          "Ladytron",
          "R√∂yksopp",
          "Simian",
          "Justice",
          "The Prodigy"
        ]
      },
      "top_artists": [
        "The Avalanches",
        "The Black Dog",
        "The Chemical Brothers",
        "UNKLE",
        "Pendulum",
        "Justice",
        "The Prodigy",
        "Loess",
        "Simian",
        "Junior Senior"
      ],
      "top_albums": [
        "The Avalanches - Since I Left You",
        "The Black Dog - Ov Mind, Ov Magick",
        "The Black Dog - Music for Real Airports",
        "UNKLE - Never, Never, Land [Japan Bonus Track]",
        "UNKLE - Psyence Fiction (Lossless)",
        "Pendulum - Immersion",
        "The Chemical Brothers - Dig Your Own Hole",
        "The Prodigy - Invaders Must Die",
        "The Black Dog - Liber Nox (Book 3 Ov 3)",
        "Simian - Never Be Alone"
      ]
    },
    {
      "name": "dance",
      "count": 71,
      "users": [
        "sdecandelario",
        "paqueradejere"
      ],
      "user_counts": {
        "paqueradejere": 26,
        "sdecandelario": 45
      },
      "user_artists": {
        "paqueradejere": [
          "The Avalanches"
        ],
        "sdecandelario": [
          "Jamiroquai",
          "Junior Senior",
          "Holy Ghost!",
          "The Chemical Brothers",
          "Miike Snow",
          "The Rapture",
          "KC and The Sunshine Band",
          "Justice",
          "The Prodigy"
        ]
      },
      "top_artists": [
        "The Avalanches",
        "Holy Ghost!",
        "The Chemical Brothers",
        "Miike Snow",
        "Justice",
        "The Prodigy",
        "Junior Senior",
        "Jamiroquai",
        "The Rapture",
        "KC and The Sunshine Band"
      ],
      "top_albums": [
        "The Avalanches - Since I Left You",
        "Miike Snow - Miike Snow",
        "Holy Ghost! - Holy Ghost!",
        "The Chemical Brothers - Dig Your Own Hole",
        "The Prodigy - Invaders Must Die",
        "Holy Ghost! - It Gets Dark",
        "The Chemical Brothers - Push the Button",
        "Junior Senior - D-D-Don't Don't Stop the Beat",
        "Justice - Justice",
        "The Rapture - Echoes"
      ]
    },
    {
      "name": "australian",
      "count": 50,
      "users": [
        "sdecandelario",
        "paqueradejere"
      ],
      "user_counts": {
        "paqueradejere": 26,
        "sdecandelario": 24
      },
      "user_artists": {
        "paqueradejere": [
          "The Avalanches"
        ],
        "sdecandelario": [
          "The New Christs",
          "The Birthday Party",
          "Tame Impala",
          "Parkway Drive",
          "Youth Group",
          "The Temper Trap"
        ]
      },
      "top_artists": [
        "The Avalanches",
        "The New Christs",
        "Parkway Drive",
        "The Birthday Party",
        "Tame Impala",
        "The Temper Trap",
        "Youth Group"
      ],
      "top_albums": [
        "The Avalanches - Since I Left You",
        "The New Christs - Distemper",
        "Parkway Drive - Don't Close Your Eyes",
        "The Birthday Party - Junkyard",
        "Tame Impala - Innerspeaker",
        "The Temper Trap - Sweet Disposition",
        "Youth Group - Punk-O-Rama Vol. 10"
      ]
    },
    {
      "name": "experimental",
      "count": 46,
      "users": [
        "sdecandelario",
        "paqueradejere"
      ],
      "user_counts": {
        "paqueradejere": 1,
        "sdecandelario": 45
      },
      "user_artists": {
        "paqueradejere": [
          "Leo Anibaldi"
        ],
        "sdecandelario": [
          "The Blood of Heroes",
          "Schwarz",
          "Sinkane",
          "Scott Walker",
          "Rrose",
          "Sonic Youth",
          "The Dillinger Escape Plan"
        ]
      },
      "top_artists": [
        "The Blood of Heroes",
        "Sonic Youth",
        "Schwarz",
        "The Dillinger Escape Plan",
        "Leo Anibaldi",
        "Sinkane",
        "Scott Walker",
        "Rrose"
      ],
      "top_albums": [
        "The Blood of Heroes - The Waking Nightmare",
        "Sonic Youth - Sister",
        "Schwarz - Heavengazers",
        "The Dillinger Escape Plan - Option Paralysis",
        "Leo Anibaldi - Void",
        "Sinkane - Mars",
        "Scott Walker - The Collection",
        "Rrose - Preretinal"
      ]
    },
    {
      "name": "female vocalists",
      "count": 44,
      "users": [
        "sdecandelario",
        "paqueradejere"
      ],
      "user_counts": {
        "paqueradejere": 14,
        "sdecandelario": 30
      },
      "user_artists": {
        "paqueradejere": [
          "PJ Harvey"
        ],
        "sdecandelario": [
          "Lyn Collins",
          "Nina Simone",
          "L7",
          "The Ting Tings",
          "The Joy Formidable",
          "Skunk Anansie",
          "Milenrama",
          "The Gathering",
          "Halestorm",
          "No Doubt",
          "Juliana R.",
          "HorrorPops",
          "Janis Joplin"
        ]
      },
      "top_artists": [
        "PJ Harvey",
        "The Ting Tings",
        "The Gathering",
        "L7",
        "No Doubt",
        "Juliana R.",
        "The Joy Formidable",
        "Skunk Anansie",
        "Milenrama",
        "Nina Simone"
      ],
      "top_albums": [
        "PJ Harvey - Rid of Me",
        "The Gathering - Disclosure",
        "The Ting Tings - Hands",
        "L7 - Smell the Magic",
        "No Doubt - The Singles Collection",
        "Juliana R. - Juliana R",
        "The Joy Formidable - The Big Roar",
        "Skunk Anansie - Smashes and Trashes",
        "Milenrama - Plumas & Pinchos - Volumen I",
        "Nina Simone - Music From The Motion Picture Watchmen"
      ]
    },
    {
      "name": "techno",
      "count": 41,
      "users": [
        "sdecandelario",
        "paqueradejere"
      ],
      "user_counts": {
        "paqueradejere": 25,
        "sdecandelario": 16
      },
      "user_artists": {
        "paqueradejere": [
          "The Black Dog",
          "Leo Anibaldi"
        ],
        "sdecandelario": [
          "Rrose",
          "SN",
          "The Chemical Brothers",
          "The Prodigy"
        ]
      },
      "top_artists": [
        "The Black Dog",
        "The Chemical Brothers",
        "The Prodigy",
        "Leo Anibaldi",
        "SN",
        "Rrose"
      ],
      "top_albums": [
        "The Black Dog - Ov Mind, Ov Magick",
        "The Black Dog - Music for Real Airports",
        "The Chemical Brothers - Dig Your Own Hole",
        "The Prodigy - Invaders Must Die",
        "The Black Dog - Liber Nox (Book 3 Ov 3)",
        "The Chemical Brothers - Push the Button",
        "The Black Dog - Parallel",
        "Leo Anibaldi - Void",
        "SN - Plumas & Pinchos - Volumen I",
        "Rrose - Preretinal"
      ]
    }
  ],
  "labels": [],
  "years": [],
  "novelties": {
    "nuevos": {
      "artists": [],
      "albums": [
        {
          "name": "Enter Shikari - Common Dreads",
          "artist": "Enter Shikari",
          "album": "Common Dreads",
          "count": 15,
          "users": [
            "sdecandelario"
          ],
          "first_date": 1356474676
        },
        {
          "name": "Bruce Springsteen - The River",
          "artist": "Bruce Springsteen",
          "album": "The River",
          "count": 20,
          "users": [
            "sdecandelario"
          ],
          "first_date": 1355306524
        },
        {
          "name": "Eels - Electro-Shock Blues",
          "artist": "Eels",
          "album": "Electro-Shock Blues",
          "count": 16,
          "users": [
            "sdecandelario"
          ],
          "first_date": 1355214687
        },
        {
          "name": "Bad Brains - Rock for Light",
          "artist": "Bad Brains",
          "album": "Rock for Light",
          "count": 20,
          "users": [
            "sdecandelario"
          ],
          "first_date": 1355159910
        }
      ],
      "tracks": [
        {
          "name": "Spector - Celestine",
          "artist": "Spector",
          "track": "Celestine",
          "count": 6,
          "users": [
            "sdecandelario"
          ],
          "first_date": 1355507117
        },
        {
          "name": "Spector - Chevy Thunder",
          "artist": "Spector",
          "track": "Chevy Thunder",
          "count": 5,
          "users": [
            "sdecandelario"
          ],
          "first_date": 1355504484
        },
        {
          "name": "The Soft Pack - Tallboy",
          "artist": "The Soft Pack",
          "track": "Tallboy",
          "count": 3,
          "users": [
            "sdecandelario"
          ],
          "first_date": 1355132848
        },
        {
          "name": "Grace Jones - Williams Blood - Greg Wilson Version",
          "artist": "Grace Jones",
          "track": "Williams Blood - Greg Wilson Version",
          "count": 3,
          "users": [
            "sdecandelario"
          ],
          "first_date": 1355127772
        },
        {
          "name": "The Cure - Switch",
          "artist": "The Cure",
          "track": "Switch",
          "count": 3,
          "users": [
            "sdecandelario"
          ],
          "first_date": 1354814170
        },
        {
          "name": "Die Antwoord - Fatty Boom Boom",
          "artist": "Die Antwoord",
          "track": "Fatty Boom Boom",
          "count": 5,
          "users": [
            "sdecandelario"
          ],
          "first_date": 1354807481
        },
        {
          "name": "The Avalanches - Electricity",
          "artist": "The Avalanches",
          "track": "Electricity",
          "count": 2,
          "users": [
            "paqueradejere"
          ],
          "first_date": 1354793393
        },
        {
          "name": "The Avalanches - A Different Feeling",
          "artist": "The Avalanches",
          "track": "A Different Feeling",
          "count": 2,
          "users": [
            "paqueradejere"
          ],
          "first_date": 1354793129
        },
        {
          "name": "The Avalanches - Diners Only",
          "artist": "The Avalanches",
          "track": "Diners Only",
          "count": 2,
          "users": [
            "paqueradejere"
          ],
          "first_date": 1354793025
        },
        {
          "name": "The Avalanches - Stay Another Season",
          "artist": "The Avalanches",
          "track": "Stay Another Season",
          "count": 3,
          "users": [
            "paqueradejere"
          ],
          "first_date": 1354791902
        },
        {
          "name": "The Avalanches - Since I Left You",
          "artist": "The Avalanches",
          "track": "Since I Left You",
          "count": 4,
          "users": [
            "paqueradejere"
          ],
          "first_date": 1354791643
        }
      ]
    },
    "nuevos_compartidos": {
      "artists": [],
      "albums": [],
      "tracks": []
    },
    "nuevos_para_usuario": {
      "artists": [],
      "albums": [],
      "tracks": []
    },
    "nuevos_para_usuarios": {}
  },
  "period_label": "December 2012",
  "from_date": "2012-12-01",
  "to_date": "2012-12-31",
  "generated_at": "2025-11-21 13:27"
};
        const hasNovelties = stats.novelties !== undefined;

        // Funci√≥n para obtener novedades de usuario desde datos precalculados
        function getUserNovelties(user) {
            if (!stats.novelties || !stats.novelties.nuevos_para_usuarios) {
                return { artists: [], albums: [], tracks: [] };
            }

            return stats.novelties.nuevos_para_usuarios[user] || { artists: [], albums: [], tracks: [] };
        }

        // Funcionalidad del bot√≥n de usuario
        function initializeUserSelector() {
            const userButton = document.getElementById('userButton');
            const userModal = document.getElementById('userModal');
            const userModalClose = document.getElementById('userModalClose');
            const userOptions = document.getElementById('userOptions');

            // Cargar usuario guardado desde localStorage
            let selectedUser = localStorage.getItem('lastfm_selected_user') || '';

            // Llenar opciones de usuarios
            availableUsers.forEach(user => {
                const option = document.createElement('div');
                option.className = 'user-option';
                option.dataset.user = user;
                option.textContent = user;
                userOptions.appendChild(option);
            });

            // Marcar opci√≥n seleccionada
            updateSelectedUserOption(selectedUser);

            // Event listeners
            userButton.addEventListener('click', () => {
                userModal.style.display = 'block';
            });

            userModalClose.addEventListener('click', () => {
                userModal.style.display = 'none';
            });

            userModal.addEventListener('click', (e) => {
                if (e.target === userModal) {
                    userModal.style.display = 'none';
                }
            });

            userOptions.addEventListener('click', (e) => {
                if (e.target.classList.contains('user-option')) {
                    const user = e.target.dataset.user;
                    selectedUser = user;

                    // Guardar en localStorage
                    if (user) {
                        localStorage.setItem('lastfm_selected_user', user);
                    } else {
                        localStorage.removeItem('lastfm_selected_user');
                    }

                    updateSelectedUserOption(user);
                    userModal.style.display = 'none';
                    renderStats(); // Re-renderizar con nuevo usuario
                }
            });

            return selectedUser;
        }

        function updateSelectedUserOption(selectedUser) {
            const userOptions = document.getElementById('userOptions');
            userOptions.querySelectorAll('.user-option').forEach(option => {
                option.classList.remove('selected');
                if (option.dataset.user === selectedUser) {
                    option.classList.add('selected');
                }
            });
        }

        // Inicializar categor√≠as activas
        let activeCategories = new Set(['artists']); // Por defecto mostrar artistas
        let selectedUser = '';

        document.getElementById('dateRange').textContent = `${stats.from_date || ''} ‚Üí ${stats.to_date || ''}`;
        document.getElementById('totalScrobbles').textContent = stats.total_scrobbles || 0;
        document.getElementById('generatedAt').textContent = stats.generated_at || '';

        // Manejar filtros de categor√≠as
        const categoryFilters = document.querySelectorAll('.category-filter');
        categoryFilters.forEach(filter => {
            filter.addEventListener('click', () => {
                const category = filter.dataset.category;

                if (activeCategories.has(category)) {
                    activeCategories.delete(category);
                    filter.classList.remove('active');
                } else {
                    activeCategories.add(category);
                    filter.classList.add('active');
                }

                renderStats();
            });
        });

        function showArtistsPopup(itemName, category, user) {
            const item = stats[category].find(item => item.name === itemName);
            if (!item || !item.user_artists || !item.user_artists[user]) return;

            const artists = item.user_artists[user];

            // Crear overlay
            const overlay = document.createElement('div');
            overlay.className = 'popup-overlay';

            // Crear popup
            const popup = document.createElement('div');
            popup.className = 'artists-popup';

            const header = document.createElement('div');
            header.className = 'popup-header';

            const closeBtn = document.createElement('button');
            closeBtn.className = 'popup-close';
            closeBtn.innerHTML = '√ó';
            closeBtn.onclick = () => {
                document.body.removeChild(overlay);
                document.body.removeChild(popup);
            };

            header.innerHTML = `Artistas de ${user} en "${itemName}"`;
            header.appendChild(closeBtn);

            const artistList = document.createElement('ul');
            artistList.className = 'artist-list';

            artists.forEach(artist => {
                const li = document.createElement('li');
                li.textContent = artist;
                artistList.appendChild(li);
            });

            popup.appendChild(header);
            popup.appendChild(artistList);

            // Cerrar al hacer click en overlay
            overlay.onclick = () => {
                document.body.removeChild(overlay);
                document.body.removeChild(popup);
            };

            document.body.appendChild(overlay);
            document.body.appendChild(popup);
        }

        function createNoveltyItem(item, selectedUser) {
            const itemDiv = document.createElement('div');
            itemDiv.className = 'item';

            if (selectedUser && item.users.includes(selectedUser)) {
                itemDiv.classList.add('highlighted');
            }

            const itemName = document.createElement('div');
            itemName.className = 'item-name';
            itemName.textContent = item.name;
            itemDiv.appendChild(itemName);

            const itemMeta = document.createElement('div');
            itemMeta.className = 'item-meta';

            // Conteo de plays si existe
            if (item.count) {
                const countBadge = document.createElement('span');
                countBadge.className = 'badge';
                countBadge.textContent = `${item.count} plays`;
                itemMeta.appendChild(countBadge);
            }

            // Fecha de primer scrobble
            const date = new Date(item.first_date * 1000);
            const dateBadge = document.createElement('span');
            dateBadge.className = 'badge';
            dateBadge.textContent = `Primera vez: ${date.toLocaleDateString('es-ES')}`;
            itemMeta.appendChild(dateBadge);

            // Usuarios que lo han escuchado
            item.users.forEach(user => {
                const userBadge = document.createElement('span');
                userBadge.className = 'user-badge';
                if (user === selectedUser) {
                    userBadge.classList.add('highlighted-user');
                }
                userBadge.textContent = user;
                itemMeta.appendChild(userBadge);
            });

            itemDiv.appendChild(itemMeta);
            return itemDiv;
        }

        function createUserNoveltyItem(item, selectedUser) {
            const itemDiv = document.createElement('div');
            itemDiv.className = 'item';
            itemDiv.classList.add('highlighted'); // Siempre resaltado para el usuario

            const itemName = document.createElement('div');
            itemName.className = 'item-name';
            itemName.textContent = item.name;
            itemDiv.appendChild(itemName);

            const itemMeta = document.createElement('div');
            itemMeta.className = 'item-meta';

            // Total de scrobbles del usuario para este elemento
            if (item.total_count) {
                const totalBadge = document.createElement('span');
                totalBadge.className = 'badge';
                totalBadge.style.background = '#cba6f7';
                totalBadge.style.color = '#1e1e2e';
                totalBadge.textContent = `${item.total_count} total plays`;
                itemMeta.appendChild(totalBadge);
            }

            // Scrobbles en este per√≠odo
            if (item.period_count) {
                const periodBadge = document.createElement('span');
                periodBadge.className = 'badge';
                periodBadge.textContent = `${item.period_count} plays per√≠odo`;
                itemMeta.appendChild(periodBadge);
            }

            // Fecha de primera vez del usuario (si est√° disponible)
            if (item.first_date || item.user_first_date) {
                const date = new Date((item.first_date || item.user_first_date) * 1000);
                const dateBadge = document.createElement('span');
                dateBadge.className = 'badge';
                dateBadge.style.background = '#a6e3a1';
                dateBadge.style.color = '#1e1e2e';
                dateBadge.textContent = `Primera vez: ${date.toLocaleDateString('es-ES')}`;
                itemMeta.appendChild(dateBadge);
            }

            // Usuarios que tambi√©n lo escucharon (coincidencias)
            if (item.coincident_users && item.coincident_users.length > 0) {
                item.coincident_users.forEach(user => {
                    const userBadge = document.createElement('span');
                    userBadge.className = 'user-badge';
                    userBadge.textContent = user;
                    itemMeta.appendChild(userBadge);
                });
            }

            // Informaci√≥n de coincidencias
            if (item.num_coincidences) {
                const coincidencesBadge = document.createElement('span');
                coincidencesBadge.className = 'badge';
                coincidencesBadge.style.background = '#f38ba8';
                coincidencesBadge.style.color = '#1e1e2e';
                coincidencesBadge.textContent = `${item.num_coincidences} coincidencias`;
                itemMeta.appendChild(coincidencesBadge);
            }

            itemDiv.appendChild(itemMeta);
            return itemDiv;
        }

        function renderStats() {
            const container = document.getElementById('categoriesContainer');
            container.innerHTML = '';

            const categoryTitles = {
                artists: 'Artistas M√°s Escuchados',
                tracks: 'Canciones M√°s Escuchadas',
                albums: '√Ålbumes M√°s Escuchados',
                genres: 'G√©neros M√°s Escuchados',
                labels: 'Sellos M√°s Escuchados',
                years: 'A√±os M√°s Escuchados',
                novelties: 'Novedades'
            };

            let hasData = false;

            ['artists', 'tracks', 'albums', 'genres', 'labels', 'years', 'novelties'].forEach(categoryKey => {
                if (!activeCategories.has(categoryKey)) return;

                // Manejo especial para novedades
                if (categoryKey === 'novelties') {
                    if (!hasNovelties || !stats.novelties) return;

                    hasData = true;
                    const categoryDiv = document.createElement('div');
                    categoryDiv.className = 'category visible';
                    categoryDiv.dataset.category = categoryKey;

                    const title = document.createElement('h3');
                    title.textContent = categoryTitles[categoryKey];
                    categoryDiv.appendChild(title);

                    // NUEVOS PARA TODOS
                    const nuevosSection = document.createElement('div');
                    nuevosSection.className = 'novelty-section';

                    const nuevosTitle = document.createElement('h4');
                    nuevosTitle.textContent = 'üÜï Nuevos para todos';
                    nuevosSection.appendChild(nuevosTitle);

                    ['artists', 'albums', 'tracks'].forEach(type => {
                        const subsection = document.createElement('div');
                        subsection.className = 'novelty-subsection';

                        const subsectionTitle = document.createElement('h5');
                        subsectionTitle.textContent = type === 'artists' ? 'Artistas' :
                                                     type === 'albums' ? '√Ålbumes' : 'Canciones';
                        subsection.appendChild(subsectionTitle);

                        const items = stats.novelties.nuevos[type];
                        if (items && items.length > 0) {
                            items.forEach(item => {
                                const itemDiv = createNoveltyItem(item, selectedUser);
                                subsection.appendChild(itemDiv);
                            });
                        } else {
                            const emptyDiv = document.createElement('div');
                            emptyDiv.className = 'novelty-empty';
                            emptyDiv.textContent = 'No hay elementos nuevos';
                            subsection.appendChild(emptyDiv);
                        }

                        nuevosSection.appendChild(subsection);
                    });

                    categoryDiv.appendChild(nuevosSection);

                    // NUEVOS COMPARTIDOS
                    const compartidosSection = document.createElement('div');
                    compartidosSection.className = 'novelty-section';

                    const compartidosTitle = document.createElement('h4');
                    compartidosTitle.textContent = 'üë• Nuevos compartidos (50%+ del grupo)';
                    compartidosSection.appendChild(compartidosTitle);

                    ['artists', 'albums', 'tracks'].forEach(type => {
                        const subsection = document.createElement('div');
                        subsection.className = 'novelty-subsection';

                        const subsectionTitle = document.createElement('h5');
                        subsectionTitle.textContent = type === 'artists' ? 'Artistas' :
                                                     type === 'albums' ? '√Ålbumes' : 'Canciones';
                        subsection.appendChild(subsectionTitle);

                        const items = stats.novelties.nuevos_compartidos[type];
                        if (items && items.length > 0) {
                            items.forEach(item => {
                                const itemDiv = createNoveltyItem(item, selectedUser);
                                subsection.appendChild(itemDiv);
                            });
                        } else {
                            const emptyDiv = document.createElement('div');
                            emptyDiv.className = 'novelty-empty';
                            emptyDiv.textContent = 'No hay elementos nuevos compartidos';
                            subsection.appendChild(emptyDiv);
                        }

                        compartidosSection.appendChild(subsection);
                    });

                    // NUEVOS PARA USUARIO SELECCIONADO
                    if (selectedUser) {
                        const usuarioSection = document.createElement('div');
                        usuarioSection.className = 'novelty-section';

                        const usuarioTitle = document.createElement('h4');
                        usuarioTitle.textContent = `üë§ Nuevos para ${selectedUser} (ya conocidos por el grupo)`;
                        usuarioSection.appendChild(usuarioTitle);

                        // Calcular novedades para el usuario
                        const userNovelties = getUserNovelties(selectedUser);

                        ['artists', 'albums', 'tracks'].forEach(type => {
                            const subsection = document.createElement('div');
                            subsection.className = 'novelty-subsection';

                            const subsectionTitle = document.createElement('h5');
                            subsectionTitle.textContent = type === 'artists' ? 'Artistas' :
                                                         type === 'albums' ? '√Ålbumes' : 'Canciones';
                            subsection.appendChild(subsectionTitle);

                            const items = userNovelties[type];
                            if (items && items.length > 0) {
                                items.forEach(item => {
                                    const itemDiv = createUserNoveltyItem(item, selectedUser);
                                    subsection.appendChild(itemDiv);
                                });
                            } else {
                                const emptyDiv = document.createElement('div');
                                emptyDiv.className = 'novelty-empty';
                                const typeText = type === 'artists' ? 'artistas' :
                                               type === 'albums' ? '√°lbumes' : 'canciones';
                                emptyDiv.textContent = items ?
                                    `No hay ${typeText} nuevos para ${selectedUser} con coincidencias en el per√≠odo` :
                                    'Calculando novedades del usuario...';
                                subsection.appendChild(emptyDiv);
                            }

                            usuarioSection.appendChild(subsection);
                        });

                        categoryDiv.appendChild(usuarioSection);
                    } else {
                        const usuarioSection = document.createElement('div');
                        usuarioSection.className = 'novelty-section';

                        const usuarioTitle = document.createElement('h4');
                        usuarioTitle.textContent = 'üë§ Nuevos para usuario espec√≠fico';
                        usuarioSection.appendChild(usuarioTitle);

                        const infoDiv = document.createElement('div');
                        infoDiv.className = 'novelty-empty';
                        infoDiv.textContent = 'Selecciona un usuario para ver sus novedades personales';
                        usuarioSection.appendChild(infoDiv);

                        categoryDiv.appendChild(usuarioSection);
                    }
                    container.appendChild(categoryDiv);
                    return;
                }

                if (!stats[categoryKey] || stats[categoryKey].length === 0) return;

                hasData = true;
                const categoryDiv = document.createElement('div');
                categoryDiv.className = 'category visible';
                categoryDiv.dataset.category = categoryKey;

                const title = document.createElement('h3');
                title.textContent = categoryTitles[categoryKey];
                categoryDiv.appendChild(title);

                stats[categoryKey].forEach(item => {
                    const itemDiv = document.createElement('div');
                    itemDiv.className = 'item';

                    if (selectedUser && item.users.includes(selectedUser)) {
                        itemDiv.classList.add('highlighted');
                    }

                    // Hacer clickeable si es g√©nero, a√±o o sello y hay usuario seleccionado
                    const isClickableForUser = ['genres', 'labels', 'years'].includes(categoryKey) &&
                                       selectedUser &&
                                       item.users.includes(selectedUser) &&
                                       item.user_artists &&
                                       item.user_artists[selectedUser];

                    // Hacer expandible si tiene informaci√≥n detallada
                    const isExpandable = ['genres', 'labels', 'years'].includes(categoryKey) &&
                                         ((item.top_artists && item.top_artists.length > 0) ||
                                          (item.top_albums && item.top_albums.length > 0));

                    const itemName = document.createElement('div');
                    itemName.className = 'item-name';
                    itemName.textContent = item.name;

                    if (isExpandable) {
                        itemDiv.classList.add('expandable');
                    }

                    itemDiv.appendChild(itemName);

                    const itemMeta = document.createElement('div');
                    itemMeta.className = 'item-meta';

                    const countBadge = document.createElement('span');
                    countBadge.className = 'badge';
                    countBadge.textContent = `${item.count} plays`;
                    itemMeta.appendChild(countBadge);

                    item.users.sort((a, b) => (item.user_counts[b] || 0) - (item.user_counts[a] || 0));

                    item.users.forEach(user => {
                        const userBadge = document.createElement('span');
                        userBadge.className = 'user-badge';
                        if (user === selectedUser) {
                            userBadge.classList.add('highlighted-user');
                        }

                        const userScrobbles = item.user_counts[user] || 0;
                        userBadge.textContent = `${user} (${userScrobbles})`;

                        if (isClickableForUser && user === selectedUser) {
                            userBadge.style.cursor = 'pointer';
                            userBadge.addEventListener('click', (e) => {
                                e.stopPropagation();
                                showArtistsPopup(item.name, categoryKey, user);
                            });
                        }

                        itemMeta.appendChild(userBadge);
                    });

                    itemDiv.appendChild(itemMeta);

                    // Detalles expandibles
                    if (isExpandable) {
                        const detailsDiv = document.createElement('div');
                        detailsDiv.className = 'details';

                        if (item.top_artists && item.top_artists.length > 0) {
                            const artistSection = document.createElement('div');
                            artistSection.className = 'detail-section';

                            const artistTitle = document.createElement('div');
                            artistTitle.className = 'detail-title';
                            artistTitle.textContent = 'Top Artistas:';
                            artistSection.appendChild(artistTitle);

                            const artistList = document.createElement('div');
                            artistList.className = 'detail-list';

                            item.top_artists.slice(0, 10).forEach(artist => {
                                const artistItem = document.createElement('span');
                                artistItem.className = 'detail-item';
                                artistItem.textContent = artist;
                                artistList.appendChild(artistItem);
                            });

                            artistSection.appendChild(artistList);
                            detailsDiv.appendChild(artistSection);
                        }

                        if (item.top_albums && item.top_albums.length > 0) {
                            const albumSection = document.createElement('div');
                            albumSection.className = 'detail-section';

                            const albumTitle = document.createElement('div');
                            albumTitle.className = 'detail-title';
                            albumTitle.textContent = 'Top √Ålbumes:';
                            albumSection.appendChild(albumTitle);

                            const albumList = document.createElement('div');
                            albumList.className = 'detail-list';

                            item.top_albums.slice(0, 10).forEach(album => {
                                const albumItem = document.createElement('span');
                                albumItem.className = 'detail-item';
                                albumItem.textContent = album;
                                albumList.appendChild(albumItem);
                            });

                            albumSection.appendChild(albumList);
                            detailsDiv.appendChild(albumSection);
                        }

                        itemDiv.appendChild(detailsDiv);

                        itemDiv.addEventListener('click', (e) => {
                            if (e.target.classList.contains('user-badge') && e.target.style.cursor === 'pointer') {
                                return;
                            }

                            itemDiv.classList.toggle('expanded');
                            detailsDiv.classList.toggle('expanded');
                        });
                    }

                    categoryDiv.appendChild(itemDiv);
                });

                container.appendChild(categoryDiv);
            });

            if (!hasData) {
                const noDataDiv = document.createElement('div');
                noDataDiv.className = 'no-data';
                noDataDiv.textContent = 'No hay datos para mostrar con los filtros seleccionados.';
                container.appendChild(noDataDiv);
            }
        }

        // Inicializaci√≥n
        document.addEventListener('DOMContentLoaded', function() {
            selectedUser = initializeUserSelector();
            renderStats();
        });
    </script>
</body>
</html>